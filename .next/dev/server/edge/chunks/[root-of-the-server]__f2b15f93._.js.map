{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\n/**\r\n * Comprehensive Security Middleware\r\n * Protects against XSS, CSRF, clickjacking, and other attacks\r\n */\r\nexport function middleware(request: NextRequest) {\r\n  const response = NextResponse.next();\r\n\r\n  // Security Headers\r\n  const securityHeaders = {\r\n    // Content Security Policy - Balanced security for Next.js\r\n    'Content-Security-Policy': [\r\n      \"default-src 'self'\",\r\n      \"script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://vercel.live\", // Next.js requires unsafe-inline and unsafe-eval\r\n      \"style-src 'self' 'unsafe-inline' https://fonts.googleapis.com\", // Allow inline styles for Next.js\r\n      \"font-src 'self' https://fonts.gstatic.com data:\",\r\n      \"img-src 'self' data: https: blob:\",\r\n      \"media-src 'self' data: https: blob:\",\r\n      \"connect-src 'self' https://www.google-analytics.com https://www.googletagmanager.com https://api.emersoneims.com https://vitals.vercel-insights.com wss: https://vercel.live\",\r\n      \"frame-src 'self' https://www.youtube.com https://player.vimeo.com\", // Allow embeds from trusted sources\r\n      \"object-src 'none'\",\r\n      \"base-uri 'self'\",\r\n      \"form-action 'self'\",\r\n      \"frame-ancestors 'none'\",\r\n      \"upgrade-insecure-requests\", // Force HTTPS\r\n      \"block-all-mixed-content\",\r\n    ].join('; '),\r\n\r\n    // XSS Protection\r\n    'X-XSS-Protection': '1; mode=block',\r\n    \r\n    // Prevent MIME type sniffing\r\n    'X-Content-Type-Options': 'nosniff',\r\n    \r\n    // Prevent clickjacking\r\n    'X-Frame-Options': 'DENY',\r\n    \r\n    // Referrer Policy\r\n    'Referrer-Policy': 'strict-origin-when-cross-origin',\r\n    \r\n    // Permissions Policy (formerly Feature Policy)\r\n    'Permissions-Policy': [\r\n      'camera=()',\r\n      'microphone=()',\r\n      'geolocation=()',\r\n      'interest-cohort=()', // Disable FLoC\r\n      'payment=()',\r\n      'usb=()',\r\n      'magnetometer=()',\r\n      'gyroscope=()',\r\n      'accelerometer=()',\r\n    ].join(', '),\r\n\r\n    // Strict Transport Security (HSTS)\r\n    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload',\r\n    \r\n    // Cross-Origin Policies (relaxed for Next.js compatibility)\r\n    // Note: COEP 'require-corp' can break some Next.js features\r\n    'Cross-Origin-Opener-Policy': 'same-origin-allow-popups', // Allow popups for OAuth, etc.\r\n    'Cross-Origin-Resource-Policy': 'cross-origin', // Allow cross-origin resources (fonts, images)\r\n    \r\n    // Additional Security Headers\r\n    'X-DNS-Prefetch-Control': 'on',\r\n    'X-Download-Options': 'noopen',\r\n    'X-Permitted-Cross-Domain-Policies': 'none',\r\n    \r\n    // Remove server information\r\n    'X-Powered-By': '', // Remove X-Powered-By header\r\n  };\r\n\r\n  // Apply security headers\r\n  Object.entries(securityHeaders).forEach(([key, value]) => {\r\n    if (value) {\r\n      response.headers.set(key, value);\r\n    } else {\r\n      response.headers.delete(key);\r\n    }\r\n  });\r\n\r\n  // Cache static assets aggressively\r\n  if (\r\n    request.nextUrl.pathname.startsWith('/_next/static') ||\r\n    request.nextUrl.pathname.startsWith('/images/') ||\r\n    request.nextUrl.pathname.startsWith('/media/') ||\r\n    request.nextUrl.pathname.match(/\\.(jpg|jpeg|png|gif|ico|svg|webp|avif|woff|woff2|ttf|eot)$/i)\r\n  ) {\r\n    response.headers.set(\r\n      'Cache-Control',\r\n      'public, max-age=31536000, immutable'\r\n    );\r\n  }\r\n\r\n  // Cache API responses (if needed)\r\n  if (request.nextUrl.pathname.startsWith('/api/')) {\r\n    // Add rate limiting headers (basic)\r\n    // Get IP from headers (X-Forwarded-For or X-Real-IP)\r\n    const forwardedFor = request.headers.get('x-forwarded-for');\r\n    const realIp = request.headers.get('x-real-ip');\r\n    const rateLimitKey = forwardedFor?.split(',')[0] || realIp || 'unknown';\r\n    // In production, use Redis or similar for rate limiting\r\n    response.headers.set('X-RateLimit-Limit', '100');\r\n    response.headers.set('X-RateLimit-Remaining', '99');\r\n  }\r\n\r\n  // Security: Block common attack patterns\r\n  const userAgent = request.headers.get('user-agent') || '';\r\n  const suspiciousPatterns = [\r\n    /bot/i,\r\n    /crawler/i,\r\n    /scanner/i,\r\n    /sqlmap/i,\r\n    /nikto/i,\r\n    /nmap/i,\r\n  ];\r\n\r\n  // Allow legitimate bots (Google, Bing, etc.) but block suspicious ones\r\n  const isLegitimateBot = /googlebot|bingbot|slurp|duckduckbot|baiduspider|yandexbot|sogou|exabot|facebot|ia_archiver/i.test(userAgent);\r\n  \r\n  if (!isLegitimateBot && suspiciousPatterns.some(pattern => pattern.test(userAgent))) {\r\n    return new NextResponse('Forbidden', { status: 403 });\r\n  }\r\n\r\n  return response;\r\n}\r\n\r\n// Apply middleware to all routes except static files and API routes that need different handling\r\nexport const config = {\r\n  matcher: [\r\n    /*\r\n     * Match all request paths except:\r\n     * - api (API routes)\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     * - robots.txt (robots file)\r\n     * - sitemap.xml (sitemap file)\r\n     */\r\n    '/((?!api|_next/static|_next/image|favicon.ico|robots.txt|sitemap.xml).*)',\r\n  ],\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAOO,SAAS,WAAW,OAAoB;IAC7C,MAAM,WAAW,gMAAY,CAAC,IAAI;IAElC,mBAAmB;IACnB,MAAM,kBAAkB;QACtB,0DAA0D;QAC1D,2BAA2B;YACzB;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD,CAAC,IAAI,CAAC;QAEP,iBAAiB;QACjB,oBAAoB;QAEpB,6BAA6B;QAC7B,0BAA0B;QAE1B,uBAAuB;QACvB,mBAAmB;QAEnB,kBAAkB;QAClB,mBAAmB;QAEnB,+CAA+C;QAC/C,sBAAsB;YACpB;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD,CAAC,IAAI,CAAC;QAEP,mCAAmC;QACnC,6BAA6B;QAE7B,4DAA4D;QAC5D,4DAA4D;QAC5D,8BAA8B;QAC9B,gCAAgC;QAEhC,8BAA8B;QAC9B,0BAA0B;QAC1B,sBAAsB;QACtB,qCAAqC;QAErC,4BAA4B;QAC5B,gBAAgB;IAClB;IAEA,yBAAyB;IACzB,OAAO,OAAO,CAAC,iBAAiB,OAAO,CAAC,CAAC,CAAC,KAAK,MAAM;QACnD,IAAI,OAAO;YACT,SAAS,OAAO,CAAC,GAAG,CAAC,KAAK;QAC5B,OAAO;YACL,SAAS,OAAO,CAAC,MAAM,CAAC;QAC1B;IACF;IAEA,mCAAmC;IACnC,IACE,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,oBACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,eACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,cACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,gEAC/B;QACA,SAAS,OAAO,CAAC,GAAG,CAClB,iBACA;IAEJ;IAEA,kCAAkC;IAClC,IAAI,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,UAAU;QAChD,oCAAoC;QACpC,qDAAqD;QACrD,MAAM,eAAe,QAAQ,OAAO,CAAC,GAAG,CAAC;QACzC,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;QACnC,MAAM,eAAe,cAAc,MAAM,IAAI,CAAC,EAAE,IAAI,UAAU;QAC9D,wDAAwD;QACxD,SAAS,OAAO,CAAC,GAAG,CAAC,qBAAqB;QAC1C,SAAS,OAAO,CAAC,GAAG,CAAC,yBAAyB;IAChD;IAEA,yCAAyC;IACzC,MAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC,iBAAiB;IACvD,MAAM,qBAAqB;QACzB;QACA;QACA;QACA;QACA;QACA;KACD;IAED,uEAAuE;IACvE,MAAM,kBAAkB,8FAA8F,IAAI,CAAC;IAE3H,IAAI,CAAC,mBAAmB,mBAAmB,IAAI,CAAC,CAAA,UAAW,QAAQ,IAAI,CAAC,aAAa;QACnF,OAAO,IAAI,gMAAY,CAAC,aAAa;YAAE,QAAQ;QAAI;IACrD;IAEA,OAAO;AACT;AAGO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;;;KAQC,GACD;KACD;AACH"}}]
}