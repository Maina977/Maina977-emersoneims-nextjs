module.exports=[62562,(a,b,c)=>{b.exports=a.x("module",()=>require("module"))},1236,3885,a=>{"use strict";let b;var c,d,e=a.i(39705),f=a.i(72131),g=a.i(5457),h=a.i(99777),i=a.i(87072),i=i,j=i,k=i;a.s(["extend",()=>k.e],3885);var k=i,l=a.i(35258),m=l;let n=parseInt(l.REVISION.replace(/\D+/g,""));class o extends m.Mesh{constructor(a,b){var c,d;const e=(a=>a&&a.isCubeTexture)(a),f=Math.floor(Math.log2((null!=(d=e?null==(c=a.image[0])?void 0:c.width:a.image.width)?d:1024)/4)),g=Math.pow(2,f),h=3*Math.max(g,112),i=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,j=[e?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/h}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*g)}`,`#define CUBEUV_MAX_MIP ${f}.0`].join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${n>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,k={map:{value:a},height:{value:(null==b?void 0:b.height)||15},radius:{value:(null==b?void 0:b.radius)||100}};super(new m.IcosahedronGeometry(1,16),new m.ShaderMaterial({uniforms:k,fragmentShader:j,vertexShader:i,side:m.DoubleSide}))}set radius(a){this.material.uniforms.radius.value=a}get radius(){return this.material.uniforms.radius.value}set height(a){this.material.uniforms.height.value=a}get height(){return this.material.uniforms.height.value}}var p=i,q=l;class r extends q.DataTextureLoader{constructor(a){super(a),this.type=q.HalfFloatType}parse(a){let b,c,d,e=function(a,b){switch(a){case 1:throw Error("THREE.RGBELoader: Read Error: "+(b||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(b||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(b||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(b||""))}},f=function(a,b,c){b=b||1024;let d=a.pos,e=-1,f=0,g="",h=String.fromCharCode.apply(null,new Uint16Array(a.subarray(d,d+128)));for(;0>(e=h.indexOf("\n"))&&f<b&&d<a.byteLength;)g+=h,f+=h.length,d+=128,h+=String.fromCharCode.apply(null,new Uint16Array(a.subarray(d,d+128)));return -1<e&&(!1!==c&&(a.pos+=f+e+1),g+h.slice(0,e))},g=new Uint8Array(a);g.pos=0;let h=function(a){let b,c,d=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,g=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,h=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,j={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(a.pos>=a.byteLength)&&(b=f(a))||e(1,"no header found"),(c=b.match(/^#\?(\S+)/))||e(3,"bad initial token"),j.valid|=1,j.programtype=c[1],j.string+=b+"\n";!1!==(b=f(a));){if(j.string+=b+"\n","#"===b.charAt(0)){j.comments+=b+"\n";continue}if((c=b.match(d))&&(j.gamma=parseFloat(c[1])),(c=b.match(g))&&(j.exposure=parseFloat(c[1])),(c=b.match(h))&&(j.valid|=2,j.format=c[1]),(c=b.match(i))&&(j.valid|=4,j.height=parseInt(c[1],10),j.width=parseInt(c[2],10)),2&j.valid&&4&j.valid)break}return 2&j.valid||e(3,"missing format specifier"),4&j.valid||e(3,"missing image size specifier"),j}(g),i=h.width,j=h.height,k=function(a,b,c){if(b<8||b>32767||2!==a[0]||2!==a[1]||128&a[2])return new Uint8Array(a);b!==(a[2]<<8|a[3])&&e(3,"wrong scanline width");let d=new Uint8Array(4*b*c);d.length||e(4,"unable to allocate buffer space");let f=0,g=0,h=4*b,i=new Uint8Array(4),j=new Uint8Array(h),k=c;for(;k>0&&g<a.byteLength;){g+4>a.byteLength&&e(1),i[0]=a[g++],i[1]=a[g++],i[2]=a[g++],i[3]=a[g++],(2!=i[0]||2!=i[1]||(i[2]<<8|i[3])!=b)&&e(3,"bad rgbe scanline format");let c=0,l;for(;c<h&&g<a.byteLength;){let b=(l=a[g++])>128;if(b&&(l-=128),(0===l||c+l>h)&&e(3,"bad scanline data"),b){let b=a[g++];for(let a=0;a<l;a++)j[c++]=b}else j.set(a.subarray(g,g+l),c),c+=l,g+=l}for(let a=0;a<b;a++){let c=0;d[f]=j[a+c],c+=b,d[f+1]=j[a+c],c+=b,d[f+2]=j[a+c],c+=b,d[f+3]=j[a+c],f+=4}k--}return d}(g.subarray(g.pos),i,j);switch(this.type){case q.FloatType:let l=new Float32Array(4*(d=k.length/4));for(let a=0;a<d;a++)!function(a,b,c,d){let e=Math.pow(2,a[b+3]-128)/255;c[d+0]=a[b+0]*e,c[d+1]=a[b+1]*e,c[d+2]=a[b+2]*e,c[d+3]=1}(k,4*a,l,4*a);b=l,c=q.FloatType;break;case q.HalfFloatType:let m=new Uint16Array(4*(d=k.length/4));for(let a=0;a<d;a++)!function(a,b,c,d){let e=Math.pow(2,a[b+3]-128)/255;c[d+0]=q.DataUtils.toHalfFloat(Math.min(a[b+0]*e,65504)),c[d+1]=q.DataUtils.toHalfFloat(Math.min(a[b+1]*e,65504)),c[d+2]=q.DataUtils.toHalfFloat(Math.min(a[b+2]*e,65504)),c[d+3]=q.DataUtils.toHalfFloat(1)}(k,4*a,m,4*a);b=m,c=q.HalfFloatType;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:i,height:j,data:b,header:h.string,gamma:h.gamma,exposure:h.exposure,type:c}}setDataType(a){return this.type=a,this}load(a,b,c,d){return super.load(a,function(a,c){switch(a.type){case q.FloatType:case q.HalfFloatType:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=q.LinearFilter,a.magFilter=q.LinearFilter,a.generateMipmaps=!1,a.flipY=!0}b&&b(a,c)},c,d)}}var s=l,t=(0,a.i(62562).createRequire)("/");try{d=t("worker_threads").Worker}catch(a){}var u=d?function(a,b,c,e,f){var g=!1,h=new d(a+";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global",{eval:!0}).on("error",function(a){return f(a,null)}).on("message",function(a){return f(null,a)}).on("exit",function(a){a&&!g&&f(Error("exited with code "+a),null)});return h.postMessage(c,e),h.terminate=function(){return g=!0,d.prototype.terminate.call(h)},h}:function(a,b,c,d,e){setImmediate(function(){return e(Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var f=function(){};return{terminate:f,postMessage:f}},v=Uint8Array,w=Uint16Array,x=Uint32Array,y=new v([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),z=new v([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),A=new v([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),B=function(a,b){for(var c=new w(31),d=0;d<31;++d)c[d]=b+=1<<a[d-1];for(var e=new x(c[30]),d=1;d<30;++d)for(var f=c[d];f<c[d+1];++f)e[f]=f-c[d]<<5|d;return[c,e]},C=B(y,2),D=C[0],E=C[1];D[28]=258,E[258]=28;for(var F=B(z,0),G=F[0],H=F[1],I=new w(32768),J=0;J<32768;++J){var K=(43690&J)>>>1|(21845&J)<<1;K=(61680&(K=(52428&K)>>>2|(13107&K)<<2))>>>4|(3855&K)<<4,I[J]=((65280&K)>>>8|(255&K)<<8)>>>1}for(var L=function(a,b,c){for(var d,e=a.length,f=0,g=new w(b);f<e;++f)++g[a[f]-1];var h=new w(b);for(f=0;f<b;++f)h[f]=h[f-1]+g[f-1]<<1;if(c){d=new w(1<<b);var i=15-b;for(f=0;f<e;++f)if(a[f])for(var j=f<<4|a[f],k=b-a[f],l=h[a[f]-1]++<<k,m=l|(1<<k)-1;l<=m;++l)d[I[l]>>>i]=j}else for(f=0,d=new w(e);f<e;++f)a[f]&&(d[f]=I[h[a[f]-1]++]>>>15-a[f]);return d},M=new v(288),J=0;J<144;++J)M[J]=8;for(var J=144;J<256;++J)M[J]=9;for(var J=256;J<280;++J)M[J]=7;for(var J=280;J<288;++J)M[J]=8;for(var N=new v(32),J=0;J<32;++J)N[J]=5;var O=L(M,9,0),P=L(M,9,1),Q=L(N,5,0),R=L(N,5,1),S=function(a){for(var b=a[0],c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},T=function(a,b,c){var d=b/8|0;return(a[d]|a[d+1]<<8)>>(7&b)&c},U=function(a,b){var c=b/8|0;return(a[c]|a[c+1]<<8|a[c+2]<<16)>>(7&b)},V=function(a){return(a/8|0)+(7&a&&1)},W=function(a,b,c){(null==b||b<0)&&(b=0),(null==c||c>a.length)&&(c=a.length);var d=new(a instanceof w?w:a instanceof x?x:v)(c-b);return d.set(a.subarray(b,c)),d},X=function(a,b,c){var d=a.length;if(!d||c&&!c.l&&d<5)return b||new v(0);var e=!b||c,f=!c||c.i;c||(c={}),b||(b=new v(3*d));var g=function(a){var c=b.length;if(a>c){var d=new v(Math.max(2*c,a));d.set(b),b=d}},h=c.f||0,i=c.p||0,j=c.b||0,k=c.l,l=c.d,m=c.m,n=c.n,o=8*d;do{if(!k){c.f=h=T(a,i,1);var p=T(a,i+1,3);if(i+=3,p)if(1==p)k=P,l=R,m=9,n=5;else if(2==p){var q=T(a,i,31)+257,r=T(a,i+10,15)+4,s=q+T(a,i+5,31)+1;i+=14;for(var t=new v(s),u=new v(19),w=0;w<r;++w)u[A[w]]=T(a,i+3*w,7);i+=3*r;for(var x=S(u),B=(1<<x)-1,C=L(u,x,1),w=0;w<s;){var E=C[T(a,i,B)];i+=15&E;var F=E>>>4;if(F<16)t[w++]=F;else{var H=0,I=0;for(16==F?(I=3+T(a,i,3),i+=2,H=t[w-1]):17==F?(I=3+T(a,i,7),i+=3):18==F&&(I=11+T(a,i,127),i+=7);I--;)t[w++]=H}}var J=t.subarray(0,q),K=t.subarray(q);m=S(J),n=S(K),k=L(J,m,1),l=L(K,n,1)}else throw"invalid block type";else{var F=V(i)+4,M=a[F-4]|a[F-3]<<8,N=F+M;if(N>d){if(f)throw"unexpected EOF";break}e&&g(j+M),b.set(a.subarray(F,N),j),c.b=j+=M,c.p=i=8*N;continue}if(i>o){if(f)throw"unexpected EOF";break}}e&&g(j+131072);for(var O=(1<<m)-1,Q=(1<<n)-1,X=i;;X=i){var H=k[U(a,i)&O],Y=H>>>4;if((i+=15&H)>o){if(f)throw"unexpected EOF";break}if(!H)throw"invalid length/literal";if(Y<256)b[j++]=Y;else if(256==Y){X=i,k=null;break}else{var Z=Y-254;if(Y>264){var w=Y-257,$=y[w];Z=T(a,i,(1<<$)-1)+D[w],i+=$}var _=l[U(a,i)&Q],aa=_>>>4;if(!_)throw"invalid distance";i+=15&_;var K=G[aa];if(aa>3){var $=z[aa];K+=U(a,i)&(1<<$)-1,i+=$}if(i>o){if(f)throw"unexpected EOF";break}e&&g(j+131072);for(var ab=j+Z;j<ab;j+=4)b[j]=b[j-K],b[j+1]=b[j+1-K],b[j+2]=b[j+2-K],b[j+3]=b[j+3-K];j=ab}}c.l=k,c.p=X,c.b=j,k&&(h=1,c.m=m,c.d=l,c.n=n)}while(!h)return j==b.length?b:W(b,0,j)},Y=function(a,b,c){c<<=7&b;var d=b/8|0;a[d]|=c,a[d+1]|=c>>>8},Z=function(a,b,c){c<<=7&b;var d=b/8|0;a[d]|=c,a[d+1]|=c>>>8,a[d+2]|=c>>>16},$=function(a,b){for(var c=[],d=0;d<a.length;++d)a[d]&&c.push({s:d,f:a[d]});var e=c.length,f=c.slice();if(!e)return[af,0];if(1==e){var g=new v(c[0].s+1);return g[c[0].s]=1,[g,1]}c.sort(function(a,b){return a.f-b.f}),c.push({s:-1,f:25001});var h=c[0],i=c[1],j=0,k=1,l=2;for(c[0]={s:-1,f:h.f+i.f,l:h,r:i};k!=e-1;)h=c[c[j].f<c[l].f?j++:l++],i=c[j!=k&&c[j].f<c[l].f?j++:l++],c[k++]={s:-1,f:h.f+i.f,l:h,r:i};for(var m=f[0].s,d=1;d<e;++d)f[d].s>m&&(m=f[d].s);var n=new w(m+1),o=_(c[k-1],n,0);if(o>b){var d=0,p=0,q=o-b,r=1<<q;for(f.sort(function(a,b){return n[b.s]-n[a.s]||a.f-b.f});d<e;++d){var s=f[d].s;if(n[s]>b)p+=r-(1<<o-n[s]),n[s]=b;else break}for(p>>>=q;p>0;){var t=f[d].s;n[t]<b?p-=1<<b-n[t]++-1:++d}for(;d>=0&&p;--d){var u=f[d].s;n[u]==b&&(--n[u],++p)}o=b}return[new v(n),o]},_=function(a,b,c){return -1==a.s?Math.max(_(a.l,b,c+1),_(a.r,b,c+1)):b[a.s]=c},aa=function(a){for(var b=a.length;b&&!a[--b];);for(var c=new w(++b),d=0,e=a[0],f=1,g=function(a){c[d++]=a},h=1;h<=b;++h)if(a[h]==e&&h!=b)++f;else{if(!e&&f>2){for(;f>138;f-=138)g(32754);f>2&&(g(f>10?f-11<<5|28690:f-3<<5|12305),f=0)}else if(f>3){for(g(e),--f;f>6;f-=6)g(8304);f>2&&(g(f-3<<5|8208),f=0)}for(;f--;)g(e);f=1,e=a[h]}return[c.subarray(0,d),b]},ab=function(a,b){for(var c=0,d=0;d<b.length;++d)c+=a[d]*b[d];return c},ac=function(a,b,c){var d=c.length,e=V(b+2);a[e]=255&d,a[e+1]=d>>>8,a[e+2]=255^a[e],a[e+3]=255^a[e+1];for(var f=0;f<d;++f)a[e+f+4]=c[f];return(e+4+d)*8},ad=function(a,b,c,d,e,f,g,h,i,j,k){Y(b,k++,c),++e[256];for(var l,m,n,o,p=$(e,15),q=p[0],r=p[1],s=$(f,15),t=s[0],u=s[1],v=aa(q),x=v[0],B=v[1],C=aa(t),D=C[0],E=C[1],F=new w(19),G=0;G<x.length;++G)F[31&x[G]]++;for(var G=0;G<D.length;++G)F[31&D[G]]++;for(var H=$(F,7),I=H[0],J=H[1],K=19;K>4&&!I[A[K-1]];--K);var P=j+5<<3,R=ab(e,M)+ab(f,N)+g,S=ab(e,q)+ab(f,t)+g+14+3*K+ab(F,I)+(2*F[16]+3*F[17]+7*F[18]);if(P<=R&&P<=S)return ac(b,k,a.subarray(i,i+j));if(Y(b,k,1+(S<R)),k+=2,S<R){l=L(q,r,0),m=q,n=L(t,u,0),o=t;var T=L(I,J,0);Y(b,k,B-257),Y(b,k+5,E-1),Y(b,k+10,K-4),k+=14;for(var G=0;G<K;++G)Y(b,k+3*G,I[A[G]]);k+=3*K;for(var U=[x,D],V=0;V<2;++V)for(var W=U[V],G=0;G<W.length;++G){var X=31&W[G];Y(b,k,T[X]),k+=I[X],X>15&&(Y(b,k,W[G]>>>5&127),k+=W[G]>>>12)}}else l=O,m=M,n=Q,o=N;for(var G=0;G<h;++G)if(d[G]>255){var X=d[G]>>>18&31;Z(b,k,l[X+257]),k+=m[X+257],X>7&&(Y(b,k,d[G]>>>23&31),k+=y[X]);var _=31&d[G];Z(b,k,n[_]),k+=o[_],_>3&&(Z(b,k,d[G]>>>5&8191),k+=z[_])}else Z(b,k,l[d[G]]),k+=m[d[G]];return Z(b,k,l[256]),k+m[256]},ae=new x([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),af=new v(0),ag=function(a,b,c,d,e,f){var g=a.length,h=new v(d+g+5*(1+Math.ceil(g/7e3))+e),i=h.subarray(d,h.length-e),j=0;if(!b||g<8)for(var k=0;k<=g;k+=65535){var l=k+65535;l<g?j=ac(i,j,a.subarray(k,l)):(i[k]=f,j=ac(i,j,a.subarray(k,g)))}else{for(var m=ae[b-1],n=m>>>13,o=8191&m,p=(1<<c)-1,q=new w(32768),r=new w(p+1),s=Math.ceil(c/3),t=2*s,u=function(b){return(a[b]^a[b+1]<<s^a[b+2]<<t)&p},A=new x(25e3),B=new w(288),C=new w(32),D=0,F=0,k=0,G=0,I=0,J=0;k<g;++k){var K=u(k),L=32767&k,M=r[K];if(q[L]=M,r[K]=L,I<=k){var N=g-k;if((D>7e3||G>24576)&&N>423){j=ad(a,i,0,A,B,C,F,G,J,k-J,j),G=D=F=0,J=k;for(var O=0;O<286;++O)B[O]=0;for(var O=0;O<30;++O)C[O]=0}var P=2,Q=0,R=o,S=L-M&32767;if(N>2&&K==u(k-S))for(var T=Math.min(n,N)-1,U=Math.min(32767,k),X=Math.min(258,N);S<=U&&--R&&L!=M;){if(a[k+P]==a[k+P-S]){for(var Y=0;Y<X&&a[k+Y]==a[k+Y-S];++Y);if(Y>P){if(P=Y,Q=S,Y>T)break;for(var Z=Math.min(S,Y-2),$=0,O=0;O<Z;++O){var _=k-S+O+32768&32767,aa=q[_],ab=_-aa+32768&32767;ab>$&&($=ab,M=_)}}}M=q[L=M],S+=L-M+32768&32767}if(Q){A[G++]=0x10000000|E[P]<<18|H[Q];var ag=31&E[P],ah=31&H[Q];F+=y[ag]+z[ah],++B[257+ag],++C[ah],I=k+P,++D}else A[G++]=a[k],++B[a[k]]}}j=ad(a,i,f,A,B,C,F,G,J,k-J,j),!f&&7&j&&(j=ac(i,j+1,af))}return W(h,0,d+V(j)+e)},ah=function(){for(var a=new Int32Array(256),b=0;b<256;++b){for(var c=b,d=9;--d;)c=(1&c&&-0x12477ce0)^c>>>1;a[b]=c}return a}(),ai=function(){var a=-1;return{p:function(b){for(var c=a,d=0;d<b.length;++d)c=ah[255&c^b[d]]^c>>>8;a=c},d:function(){return~a}}},aj=function(){var a=1,b=0;return{p:function(c){for(var d=a,e=b,f=c.length,g=0;g!=f;){for(var h=Math.min(g+2655,f);g<h;++g)e+=d+=c[g];d=(65535&d)+15*(d>>16),e=(65535&e)+15*(e>>16)}a=d,b=e},d:function(){return a%=65521,b%=65521,(255&a)<<24|a>>>8<<16|(255&b)<<8|b>>>8}}},ak=function(a,b,c,d,e){return ag(a,null==b.level?6:b.level,null==b.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+b.mem,c,d,!e)},al=function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c},am=function(a,b,c){for(var d=a(),e=a.toString(),f=e.slice(e.indexOf("[")+1,e.lastIndexOf("]")).replace(/ /g,"").split(","),g=0;g<d.length;++g){var h=d[g],i=f[g];if("function"==typeof h){b+=";"+i+"=";var j=h.toString();if(h.prototype)if(-1!=j.indexOf("[native code]")){var k=j.indexOf(" ",8)+1;b+=j.slice(k,j.indexOf("(",k))}else for(var l in b+=j,h.prototype)b+=";"+i+".prototype."+l+"="+h.prototype[l].toString();else b+=j}else c[i]=h}return[b,c]},an=[],ao=function(a){var b=[];for(var c in a)(a[c]instanceof v||a[c]instanceof w||a[c]instanceof x)&&b.push((a[c]=new a[c].constructor(a[c])).buffer);return b},ap=function(a,b,c,d){if(!an[c]){for(var e,f="",g={},h=a.length-1,i=0;i<h;++i)f=(e=am(a[i],f,g))[0],g=e[1];an[c]=am(a[h],f,g)}var j=al({},an[c][1]);return u(an[c][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+b.toString()+"}",c,j,ao(j),d)},aq=function(){return[v,w,x,y,z,A,D,G,P,R,I,L,S,T,U,V,W,X,aO,au,av]},ar=function(){return[v,w,x,y,z,A,E,H,O,M,Q,N,I,ae,af,L,Y,Z,$,_,aa,ab,ac,ad,V,W,ag,ak,aL,au]},as=function(){return[aD,aE]},at=function(){return[aH]},au=function(a){return postMessage(a,[a.buffer])},av=function(a){return a&&a.size&&new v(a.size)},aw=function(a){return a.ondata=function(a,b){return postMessage([a,b],[a.buffer])},function(b){return a.push(b.data[0],b.data[1])}},ax=function(a,b,c,d,e){var f,g=ap(a,d,e,function(a,c){a?(g.terminate(),b.ondata.call(b,a)):(c[1]&&g.terminate(),b.ondata.call(b,a,c[0],c[1]))});g.postMessage(c),b.push=function(a,c){if(f)throw"stream finished";if(!b.ondata)throw"no stream handler";g.postMessage([a,f=c],[a.buffer])},b.terminate=function(){g.terminate()}},ay=function(a,b){return a[b]|a[b+1]<<8},az=function(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24)>>>0},aA=function(a,b){return az(a,b)+0x100000000*az(a,b+4)},aB=function(a,b,c){for(;c;++b)a[b]=c,c>>>=8},aC=function(a,b){var c=b.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=b.level<2?4:2*(9==b.level),a[9]=3,0!=b.mtime&&aB(a,4,Math.floor(new Date(b.mtime||Date.now())/1e3)),c){a[3]=8;for(var d=0;d<=c.length;++d)a[d+10]=c.charCodeAt(d)}},aD=function(a){if(31!=a[0]||139!=a[1]||8!=a[2])throw"invalid gzip data";var b=a[3],c=10;4&b&&(c+=a[10]|(a[11]<<8)+2);for(var d=(b>>3&1)+(b>>4&1);d>0;d-=!a[c++]);return c+(2&b)},aE=function(a){var b=a.length;return(a[b-4]|a[b-3]<<8|a[b-2]<<16|a[b-1]<<24)>>>0},aF=function(a){return 10+(a.filename&&a.filename.length+1||0)},aG=function(a,b){var c=b.level,d=0==c?0:c<6?1:9==c?3:2;a[0]=120,a[1]=d<<6|(d?32-2*d:1)},aH=function(a){if((15&a[0])!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(32&a[1])throw"invalid zlib data: preset dictionaries not supported"};function aI(a,b){return b||"function"!=typeof a||(b=a,a={}),this.ondata=b,a}var aJ=function(){function a(a,b){b||"function"!=typeof a||(b=a,a={}),this.ondata=b,this.o=a||{}}return a.prototype.p=function(a,b){this.ondata(ak(a,this.o,0,0,!b),b)},a.prototype.push=function(a,b){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=b,this.p(a,b||!1)},a}(),aK=function(a,b){ax([ar,function(){return[aw,aJ]}],this,aI.call(this,a,b),function(a){onmessage=aw(new aJ(a.data))},6)};function aL(a,b){return ak(a,b||{},0,0)}var aM=function(){function a(a){this.s={},this.p=new v(0),this.ondata=a}return a.prototype.e=function(a){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var b=this.p.length,c=new v(b+a.length);c.set(this.p),c.set(a,b),this.p=c},a.prototype.c=function(a){this.d=this.s.i=a||!1;var b=this.s.b,c=X(this.p,this.o,this.s);this.ondata(W(c,b,this.s.b),this.d),this.o=W(c,this.s.b-32768),this.s.b=this.o.length,this.p=W(this.p,this.s.p/8|0),this.s.p&=7},a.prototype.push=function(a,b){this.e(a),this.c(b)},a}(),aN=function(a){this.ondata=a,ax([aq,function(){return[aw,aM]}],this,0,function(){onmessage=aw(new aM)},7)};function aO(a,b){return X(a,b)}(function(){function a(a,b){this.c=ai(),this.l=0,this.v=1,aJ.call(this,a,b)}a.prototype.push=function(a,b){aJ.prototype.push.call(this,a,b)},a.prototype.p=function(a,b){this.c.p(a),this.l+=a.length;var c=ak(a,this.o,this.v&&aF(this.o),b&&8,!b);this.v&&(aC(c,this.o),this.v=0),b&&(aB(c,c.length-8,this.c.d()),aB(c,c.length-4,this.l)),this.ondata(c,b)}})();var aP=function(){function a(a){this.v=1,aM.call(this,a)}return a.prototype.push=function(a,b){if(aM.prototype.e.call(this,a),this.v){var c=this.p.length>3?aD(this.p):4;if(c>=this.p.length&&!b)return;this.p=this.p.subarray(c),this.v=0}if(b){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}aM.prototype.c.call(this,b)},a}(),aQ=function(a){this.ondata=a,ax([aq,as,function(){return[aw,aM,aP]}],this,0,function(){onmessage=aw(new aP)},9)},aR=(function(){function a(a,b){this.c=aj(),this.v=1,aJ.call(this,a,b)}a.prototype.push=function(a,b){aJ.prototype.push.call(this,a,b)},a.prototype.p=function(a,b){this.c.p(a);var c=ak(a,this.o,this.v&&2,b&&4,!b);this.v&&(aG(c,this.o),this.v=0),b&&aB(c,c.length-4,this.c.d()),this.ondata(c,b)}}(),function(){function a(a){this.v=1,aM.call(this,a)}return a.prototype.push=function(a,b){if(aM.prototype.e.call(this,a),this.v){if(this.p.length<2&&!b)return;this.p=this.p.subarray(2),this.v=0}if(b){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}aM.prototype.c.call(this,b)},a}()),aS=function(a){this.ondata=a,ax([aq,at,function(){return[aw,aM,aR]}],this,0,function(){onmessage=aw(new aR)},11)};function aT(a,b){return X((aH(a),a.subarray(2,-4)),b)}var aU=function(){function a(a){this.G=aP,this.I=aM,this.Z=aR,this.ondata=a}return a.prototype.push=function(a,b){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(a,b);else{if(this.p&&this.p.length){var c=new v(this.p.length+a.length);c.set(this.p),c.set(a,this.p.length)}else this.p=a;if(this.p.length>2){var d=this,e=function(){d.ondata.apply(d,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(e):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(e):new this.Z(e),this.s.push(this.p,b),this.p=null}}},a}();(function(a){this.G=aQ,this.I=aN,this.Z=aS,this.ondata=a}).prototype.push=function(a,b){aU.prototype.push.call(this,a,b)};var aV="undefined"!=typeof TextEncoder&&new TextEncoder,aW="undefined"!=typeof TextDecoder&&new TextDecoder,aX=0;try{aW.decode(af,{stream:!0}),aX=1}catch(a){}var aY=function(a){for(var b="",c=0;;){var d=a[c++],e=(d>127)+(d>223)+(d>239);if(c+e>a.length)return[b,W(a,c-1)];e?3==e?b+=String.fromCharCode(55296|(d=((15&d)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536)>>10,56320|1023&d):1&e?b+=String.fromCharCode((31&d)<<6|63&a[c++]):b+=String.fromCharCode((15&d)<<12|(63&a[c++])<<6|63&a[c++]):b+=String.fromCharCode(d)}};function aZ(a,b){if(b){for(var c=new v(a.length),d=0;d<a.length;++d)c[d]=a.charCodeAt(d);return c}if(aV)return aV.encode(a);for(var e=a.length,f=new v(a.length+(a.length>>1)),g=0,h=function(a){f[g++]=a},d=0;d<e;++d){if(g+5>f.length){var i=new v(g+8+(e-d<<1));i.set(f),f=i}var j=a.charCodeAt(d);j<128||b?h(j):(j<2048?h(192|j>>6):(j>55295&&j<57344?(h(240|(j=65536+(1047552&j)|1023&a.charCodeAt(++d))>>18),h(128|j>>12&63)):h(224|j>>12),h(128|j>>6&63)),h(128|63&j))}return W(f,0,g)}(function(a){this.ondata=a,aX?this.t=new TextDecoder:this.p=af}).prototype.push=function(a,b){if(!this.ondata)throw"no callback";if(b=!!b,this.t){if(this.ondata(this.t.decode(a,{stream:!0}),b),b){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var c=new v(this.p.length+a.length);c.set(this.p),c.set(a,this.p.length);var d=aY(c),e=d[0],f=d[1];if(b){if(f.length)throw"invalid utf-8 data";this.p=null}else this.p=f;this.ondata(e,b)},(function(a){this.ondata=a}).prototype.push=function(a,b){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(aZ(a),this.d=b||!1)};var a$=function(a){return 1==a?3:a<6?2:+(9==a)},a_=function(a,b){for(;1!=ay(a,b);b+=4+ay(a,b+2));return[aA(a,b+12),aA(a,b+4),aA(a,b+20)]},a0=function(a){var b=0;if(a)for(var c in a){var d=a[c].length;if(d>65535)throw"extra field too long";b+=d+4}return b},a1=function(a,b,c,d,e,f,g,h){var i=d.length,j=c.extra,k=h&&h.length,l=a0(j);aB(a,b,null!=g?0x2014b50:0x4034b50),b+=4,null!=g&&(a[b++]=20,a[b++]=c.os),a[b]=20,b+=2,a[b++]=c.flag<<1|(null==f&&8),a[b++]=e&&8,a[b++]=255&c.compression,a[b++]=c.compression>>8;var m=new Date(null==c.mtime?Date.now():c.mtime),n=m.getFullYear()-1980;if(n<0||n>119)throw"date not in range 1980-2099";if(aB(a,b,n<<25|m.getMonth()+1<<21|m.getDate()<<16|m.getHours()<<11|m.getMinutes()<<5|m.getSeconds()>>>1),b+=4,null!=f&&(aB(a,b,c.crc),aB(a,b+4,f),aB(a,b+8,c.size)),aB(a,b+12,i),aB(a,b+14,l),b+=16,null!=g&&(aB(a,b,k),aB(a,b+6,c.attrs),aB(a,b+10,g),b+=14),a.set(d,b),b+=i,l)for(var o in j){var p=j[o],q=p.length;aB(a,b,+o),aB(a,b+2,q),a.set(p,b+4),b+=4+q}return k&&(a.set(h,b),b+=k),b},a2=function(a,b,c,d,e){aB(a,b,0x6054b50),aB(a,b+8,c),aB(a,b+10,c),aB(a,b+12,d),aB(a,b+16,e)},a3=function(){function a(a){this.filename=a,this.c=ai(),this.size=0,this.compression=0}return a.prototype.process=function(a,b){this.ondata(null,a,b)},a.prototype.push=function(a,b){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(a),this.size+=a.length,b&&(this.crc=this.c.d()),this.process(a,b||!1)},a}();function a4(a,b){var c=this;b||(b={}),a3.call(this,a),this.d=new aJ(b,function(a,b){c.ondata(null,a,b)}),this.compression=8,this.flag=a$(b.level)}function a5(a,b){var c=this;b||(b={}),a3.call(this,a),this.d=new aK(b,function(a,b,d){c.ondata(a,b,d)}),this.compression=8,this.flag=a$(b.level),this.terminate=this.d.terminate}function a6(a){this.ondata=a,this.u=[],this.d=1}a4.prototype.process=function(a,b){try{this.d.push(a,b)}catch(a){this.ondata(a,null,b)}},a4.prototype.push=function(a,b){a3.prototype.push.call(this,a,b)},a5.prototype.process=function(a,b){this.d.push(a,b)},a5.prototype.push=function(a,b){a3.prototype.push.call(this,a,b)},a6.prototype.add=function(a){var b=this;if(2&this.d)throw"stream finished";var c=aZ(a.filename),d=c.length,e=a.comment,f=e&&aZ(e),g=d!=a.filename.length||f&&e.length!=f.length,h=d+a0(a.extra)+30;if(d>65535)throw"filename too long";var i=new v(h);a1(i,0,a,c,g);var j=[i],k=function(){for(var a=0,c=j;a<c.length;a++){var d=c[a];b.ondata(null,d,!1)}j=[]},l=this.d;this.d=0;var m=this.u.length,n=al(a,{f:c,u:g,o:f,t:function(){a.terminate&&a.terminate()},r:function(){if(k(),l){var a=b.u[m+1];a?a.r():b.d=1}l=1}}),o=0;a.ondata=function(c,d,e){if(c)b.ondata(c,d,e),b.terminate();else if(o+=d.length,j.push(d),e){var f=new v(16);aB(f,0,0x8074b50),aB(f,4,a.crc),aB(f,8,o),aB(f,12,a.size),j.push(f),n.c=o,n.b=h+o+16,n.crc=a.crc,n.size=a.size,l&&n.r(),l=1}else l&&k()},this.u.push(n)},a6.prototype.end=function(){var a=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&a.d&&(a.u.splice(-1,1),a.e())},t:function(){}}),this.d=3},a6.prototype.e=function(){for(var a=0,b=0,c=0,d=0,e=this.u;d<e.length;d++){var f=e[d];c+=46+f.f.length+a0(f.extra)+(f.o?f.o.length:0)}for(var g=new v(c+22),h=0,i=this.u;h<i.length;h++){var f=i[h];a1(g,a,f,f.f,f.u,f.c,b,f.o),a+=46+f.f.length+a0(f.extra)+(f.o?f.o.length:0),b+=f.b}a2(g,a,this.u.length,c,b),this.ondata(null,g,!0),this.d=2},a6.prototype.terminate=function(){for(var a=0,b=this.u;a<b.length;a++)b[a].t();this.d=2};var a7=function(){function a(){}return a.prototype.push=function(a,b){this.ondata(null,a,b)},a.compression=0,a}();function a8(){var a=this;this.i=new aM(function(b,c){a.ondata(null,b,c)})}function a9(a,b){var c=this;b<32e4?this.i=new aM(function(a,b){c.ondata(null,a,b)}):(this.i=new aN(function(a,b,d){c.ondata(a,b,d)}),this.terminate=this.i.terminate)}function ba(a){this.onfile=a,this.k=[],this.o={0:a7},this.p=af}a8.prototype.push=function(a,b){try{this.i.push(a,b)}catch(c){this.ondata(c,a,b)}},a8.compression=8,a9.prototype.push=function(a,b){this.i.terminate&&(a=W(a,0)),this.i.push(a,b)},a9.compression=8,ba.prototype.push=function(a,b){var c=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var d=Math.min(this.c,a.length),e=a.subarray(0,d);if(this.c-=d,this.d?this.d.push(e,!this.c):this.k[0].push(e),(a=a.subarray(d)).length)return this.push(a,b)}else{var f=0,g=0,h=void 0,i=void 0;this.p.length?a.length?((i=new v(this.p.length+a.length)).set(this.p),i.set(a,this.p.length)):i=this.p:i=a;for(var j=i.length,k=this.c,l=k&&this.d,m=this;g<j-4&&"break"!==function(){var a=az(i,g);if(0x4034b50==a){f=1,h=g,m.d=null,m.c=0;var b=ay(i,g+6),d=ay(i,g+8),e=8&b,l=ay(i,g+26),n=ay(i,g+28);if(j>g+30+l+n){var o,p,q=[];m.k.unshift(q),f=2;var r=az(i,g+18),s=az(i,g+22),t=function(a,b){if(b){for(var c="",d=0;d<a.length;d+=16384)c+=String.fromCharCode.apply(null,a.subarray(d,d+16384));return c}if(aW)return aW.decode(a);var e=aY(a),f=e[0];if(e[1].length)throw"invalid utf-8 data";return f}(i.subarray(g+30,g+=30+l),!(2048&b));0xffffffff==r?(r=(o=e?[-2]:a_(i,g))[0],s=o[1]):e&&(r=-1),g+=n,m.c=r;var u={name:t,compression:d,start:function(){if(!u.ondata)throw"no callback";if(r){var a=c.o[d];if(!a)throw"unknown compression type "+d;(p=r<0?new a(t):new a(t,r,s)).ondata=function(a,b,c){u.ondata(a,b,c)};for(var b=0;b<q.length;b++){var e=q[b];p.push(e,!1)}c.k[0]==q&&c.c?c.d=p:p.push(af,!0)}else u.ondata(null,af,!0)},terminate:function(){p&&p.terminate&&p.terminate()}};r>=0&&(u.size=r,u.originalSize=s),m.onfile(u)}return"break"}if(k){if(0x8074b50==a)return h=g+=12+(-2==k&&8),f=3,m.c=0,"break";else if(0x2014b50==a)return h=g-=4,f=3,m.c=0,"break"}}();++g);if(this.p=af,k<0){var n=f?i.subarray(0,h-12-(-2==k&&8)-(0x8074b50==az(i,h-16)&&4)):i.subarray(0,g);l?l.push(n,!!f):this.k[+(2==f)].push(n)}if(2&f)return this.push(i.subarray(g),b);this.p=i.subarray(g)}if(b){if(this.c)throw"invalid zip file";this.p=null}},ba.prototype.register=function(a){this.o[a.compression]=a};let bb=n>=152;class bc extends s.DataTextureLoader{constructor(a){super(a),this.type=s.HalfFloatType}parse(a){let b={l:0,c:0,lc:0};function c(a,c,d,e,f){for(;d<a;)c=c<<8|A(e,f),d+=8;b.l=c>>(d-=a)&(1<<a)-1,b.c=c,b.lc=d}let d=Array(59),e={c:0,lc:0};function f(a,b,c,d){a=a<<8|A(c,d),b+=8,e.c=a,e.lc=b}let g={c:0,lc:0};function h(a,b,c,d,h,i,j,k,l,m){if(a==b){d<8&&(f(c,d,h,j),c=e.c,d=e.lc);var n=c>>(d-=8),n=new Uint8Array([n])[0];if(l.value+n>m)return!1;for(var o=k[l.value-1];n-- >0;)k[l.value++]=o}else{if(!(l.value<m))return!1;k[l.value++]=a}g.c=c,g.lc=d}function i(a){var b=65535&a;return b>32767?b-65536:b}let j={a:0,b:0};function k(a,b){var c=i(a),d=i(b),e=c+(1&d)+(d>>1),f=e-d;j.a=e,j.b=f}function l(a,b){var c=65535&b,d=(65535&a)-(c>>1)&65535;j.a=c+d-32768&65535,j.b=d}function m(a,i,j,k,l,m){var n=j.value,o=z(i,j),p=z(i,j);j.value+=4;var q=z(i,j);if(j.value+=4,o<0||o>=65537||p<0||p>=65537)throw"Something wrong with HUF_ENCSIZE";for(var r=Array(65537),s=Array(16384),t=0;t<16384;t++)s[t]={},s[t].len=0,s[t].lit=0,s[t].p=null;var u=k-(j.value-n);if(!function(a,e,f,g,h,i,j){for(var k=0,l=0;h<=i;h++){if(f.value-f.value>g)return!1;c(6,k,l,a,f);var m=b.l;if(k=b.c,l=b.lc,j[h]=m,63==m){if(f.value-f.value>g)throw"Something wrong with hufUnpackEncTable";c(8,k,l,a,f);var n=b.l+6;if(k=b.c,l=b.lc,h+n>i+1)throw"Something wrong with hufUnpackEncTable";for(;n--;)j[h++]=0;h--}else if(m>=59){var n=m-59+2;if(h+n>i+1)throw"Something wrong with hufUnpackEncTable";for(;n--;)j[h++]=0;h--}}!function(a){for(var b=0;b<=58;++b)d[b]=0;for(var b=0;b<65537;++b)d[a[b]]+=1;for(var c=0,b=58;b>0;--b){var e=c+d[b]>>1;d[b]=c,c=e}for(var b=0;b<65537;++b){var f=a[b];f>0&&(a[b]=f|d[f]++<<6)}}(j)}(a,0,j,u,o,p,r),q>8*(k-(j.value-n)))throw"Something wrong with hufUncompress";!function(a,b,c,d){for(;b<=c;b++){var e=a[b]>>6,f=63&a[b];if(e>>f)throw"Invalid table entry";if(f>14){var g=d[e>>f-14];if(g.len)throw"Invalid table entry";if(g.lit++,g.p){var h=g.p;g.p=Array(g.lit);for(var i=0;i<g.lit-1;++i)g.p[i]=h[i]}else g.p=[,];g.p[g.lit-1]=b}else if(f)for(var j=0,i=1<<14-f;i>0;i--){var g=d[(e<<14-f)+j];if(g.len||g.p)throw"Invalid table entry";g.len=f,g.lit=b,j++}}}(r,o,p,s),function(a,b,c,d,i,j,k,l,m,n){for(var o=0,p=0,q=Math.trunc(i.value+(j+7)/8);i.value<q;)for(f(o,p,c,i),o=e.c,p=e.lc;p>=14;){var r=b[o>>p-14&16383];if(r.len)p-=r.len,h(r.lit,k,o,p,c,d,i,m,n,l),o=g.c,p=g.lc;else{if(!r.p)throw"hufDecode issues";for(s=0;s<r.lit;s++){for(var s,t=63&a[r.p[s]];p<t&&i.value<q;)f(o,p,c,i),o=e.c,p=e.lc;if(p>=t&&a[r.p[s]]>>6==(o>>p-t&(1<<t)-1)){p-=t,h(r.p[s],k,o,p,c,d,i,m,n,l),o=g.c,p=g.lc;break}}if(s==r.lit)throw"hufDecode issues"}}var u=8-j&7;for(o>>=u,p-=u;p>0;){var r=b[o<<14-p&16383];if(r.len)p-=r.len,h(r.lit,k,o,p,c,d,i,m,n,l),o=g.c,p=g.lc;else throw"hufDecode issues"}}(r,s,a,i,j,q,p,m,l,{value:0})}function n(a){for(var b=1;b<a.length;b++){var c=a[b-1]+a[b]-128;a[b]=c}}function o(a,b){for(var c=0,d=Math.floor((a.length+1)/2),e=0,f=a.length-1;!(e>f)&&(b[e++]=a[c++],!(e>f));){;b[e++]=a[d++]}}function p(a){for(var b=a.byteLength,c=[],d=0,e=new DataView(a);b>0;){var f=e.getInt8(d++);if(f<0){var g=-f;b-=g+1;for(var h=0;h<g;h++)c.push(e.getUint8(d++))}else{var g=f;b-=2;for(var i=e.getUint8(d++),h=0;h<g+1;h++)c.push(i)}}return c}function q(a){return new DataView(a.array.buffer,a.offset.value,a.size)}function r(a){var b=new Uint8Array(p(a.viewer.buffer.slice(a.offset.value,a.offset.value+a.size))),c=new Uint8Array(b.length);return n(b),o(b,c),new DataView(c.buffer)}function t(a){var b=aT(a.array.slice(a.offset.value,a.offset.value+a.size)),c=new Uint8Array(b.length);return n(b),o(b,c),new DataView(c.buffer)}function u(a){for(var b=a.viewer,c={value:a.offset.value},d=new Uint16Array(a.width*a.scanlineBlockSize*(a.channels*a.type)),e=new Uint8Array(8192),f=0,g=Array(a.channels),h=0;h<a.channels;h++)g[h]={},g[h].start=f,g[h].end=g[h].start,g[h].nx=a.width,g[h].ny=a.lines,g[h].size=a.type,f+=g[h].nx*g[h].ny*g[h].size;var i=G(b,c),n=G(b,c);if(n>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(i<=n)for(var h=0;h<n-i+1;h++)e[h+i]=B(b,c);var o=new Uint16Array(65536),p=function(a,b){for(var c=0,d=0;d<65536;++d)(0==d||a[d>>3]&1<<(7&d))&&(b[c++]=d);for(var e=c-1;c<65536;)b[c++]=0;return e}(e,o),q=z(b,c);m(a.array,b,c,q,d,f);for(var h=0;h<a.channels;++h)for(var r=g[h],s=0;s<g[h].size;++s)!function(a,b,c,d,e,f,g){for(var h=g<16384,i=c>e?e:c,m=1;m<=i;)m<<=1;for(m>>=1,n=m,m>>=1;m>=1;){for(var n,o,p,q,r,s=0,t=0+f*(e-n),u=f*m,v=f*n,w=d*m,x=d*n;s<=t;s+=v){for(var y=s,z=s+d*(c-n);y<=z;y+=x){var A=y+w,B=y+u,C=B+w;h?(k(a[y+b],a[B+b]),o=j.a,q=j.b,k(a[A+b],a[C+b]),p=j.a,r=j.b,k(o,p),a[y+b]=j.a,a[A+b]=j.b,k(q,r)):(l(a[y+b],a[B+b]),o=j.a,q=j.b,l(a[A+b],a[C+b]),p=j.a,r=j.b,l(o,p),a[y+b]=j.a,a[A+b]=j.b,l(q,r)),a[B+b]=j.a,a[C+b]=j.b}if(c&m){var B=y+u;h?k(a[y+b],a[B+b]):l(a[y+b],a[B+b]),o=j.a,a[B+b]=j.b,a[y+b]=o}}if(e&m)for(var y=s,z=s+d*(c-n);y<=z;y+=x){var A=y+w;h?k(a[y+b],a[A+b]):l(a[y+b],a[A+b]),o=j.a,a[A+b]=j.b,a[y+b]=o}n=m,m>>=1}}(d,r.start+s,r.nx,r.size,r.ny,r.nx*r.size,p);for(var t=f,u=0;u<t;++u)d[u]=o[d[u]];for(var v=0,w=new Uint8Array(d.buffer.byteLength),x=0;x<a.lines;x++)for(var y=0;y<a.channels;y++){var r=g[y],A=r.nx*r.size,C=new Uint8Array(d.buffer,2*r.end,2*A);w.set(C,v),v+=2*A,r.end+=A}return new DataView(w.buffer)}function v(a){var b=aT(a.array.slice(a.offset.value,a.offset.value+a.size));let c=a.lines*a.channels*a.width,d=1==a.type?new Uint16Array(c):new Uint32Array(c),e=0,f=0,g=[,,,,];for(let c=0;c<a.lines;c++)for(let c=0;c<a.channels;c++){let c=0;switch(a.type){case 1:g[0]=e,g[1]=g[0]+a.width,e=g[1]+a.width;for(let e=0;e<a.width;++e)c+=b[g[0]++]<<8|b[g[1]++],d[f]=c,f++;break;case 2:g[0]=e,g[1]=g[0]+a.width,g[2]=g[1]+a.width,e=g[2]+a.width;for(let e=0;e<a.width;++e)c+=b[g[0]++]<<24|b[g[1]++]<<16|b[g[2]++]<<8,d[f]=c,f++}}return new DataView(d.buffer)}function w(a){var b=a.viewer,c={value:a.offset.value},d=new Uint8Array(a.width*a.lines*(a.channels*a.type*2)),e={version:C(b,c),unknownUncompressedSize:C(b,c),unknownCompressedSize:C(b,c),acCompressedSize:C(b,c),dcCompressedSize:C(b,c),rleCompressedSize:C(b,c),rleUncompressedSize:C(b,c),rleRawSize:C(b,c),totalAcUncompressedCount:C(b,c),totalDcUncompressedCount:C(b,c),acCompression:C(b,c)};if(e.version<2)throw"EXRLoader.parse: "+L.compression+" version "+e.version+" is unsupported";for(var f=[],g=G(b,c)-2;g>0;){var h=x(b.buffer,c),i=B(b,c),j=i>>2&3,k=new Int8Array([(i>>4)-1])[0],l=B(b,c);f.push({name:h,index:k,type:l,compression:j}),g-=h.length+3}for(var n=L.channels,o=Array(a.channels),q=0;q<a.channels;++q){var r=o[q]={},u=n[q];r.name=u.name,r.compression=0,r.decoded=!1,r.type=u.pixelType,r.pLinear=u.pLinear,r.width=a.width,r.height=a.lines}for(var v={idx:[,,,]},w=0;w<a.channels;++w)for(var r=o[w],q=0;q<f.length;++q){var y=f[q];r.name==y.name&&(r.compression=y.compression,y.index>=0&&(v.idx[y.index]=w),r.offset=w)}if(e.acCompressedSize>0)switch(e.acCompression){case 0:var z=new Uint16Array(e.totalAcUncompressedCount);m(a.array,b,c,e.acCompressedSize,z,e.totalAcUncompressedCount);break;case 1:var A=a.array.slice(c.value,c.value+e.totalAcUncompressedCount),D=aT(A),z=new Uint16Array(D.buffer);c.value+=e.totalAcUncompressedCount}if(e.dcCompressedSize>0){var E=new Uint16Array(t({array:a.array,offset:c,size:e.dcCompressedSize}).buffer);c.value+=e.dcCompressedSize}if(e.rleRawSize>0){var A=a.array.slice(c.value,c.value+e.rleCompressedSize),D=aT(A),H=p(D.buffer);c.value+=e.rleCompressedSize}for(var I=0,J=Array(o.length),q=0;q<J.length;++q)J[q]=[];for(var K=0;K<a.lines;++K)for(var M=0;M<o.length;++M)J[M].push(I),I+=o[M].width*a.type*2;!function(a,b,c,d,e,f){var g=new DataView(f.buffer),h=c[a.idx[0]].width,i=c[a.idx[0]].height,j=Math.floor(h/8),k=Math.ceil(h/8),l=Math.ceil(i/8),m=h-(k-1)*8,n=i-(l-1)*8,o={value:0},p=[,,,],q=[,,,],r=[,,,],t=[,,,],u=[,,,];for(let c=0;c<3;++c)u[c]=b[a.idx[c]],p[c]=c<1?0:p[c-1]+k*l,q[c]=new Float32Array(64),r[c]=new Uint16Array(64),t[c]=new Uint16Array(64*k);for(let b=0;b<l;++b){var v,w,x=8;b==l-1&&(x=n);var y=8;for(let a=0;a<k;++a){a==k-1&&(y=m);for(let a=0;a<3;++a){r[a].fill(0),r[a][0]=e[p[a]++],function(a,b,c){for(var d,e=1;e<64;)65280==(d=b[a.value])?e=64:d>>8==255?e+=255&d:(c[e]=d,e++),a.value++}(o,d,r[a]),v=r[a],(w=q[a])[0]=F(v[0]),w[1]=F(v[1]),w[2]=F(v[5]),w[3]=F(v[6]),w[4]=F(v[14]),w[5]=F(v[15]),w[6]=F(v[27]),w[7]=F(v[28]),w[8]=F(v[2]),w[9]=F(v[4]),w[10]=F(v[7]),w[11]=F(v[13]),w[12]=F(v[16]),w[13]=F(v[26]),w[14]=F(v[29]),w[15]=F(v[42]),w[16]=F(v[3]),w[17]=F(v[8]),w[18]=F(v[12]),w[19]=F(v[17]),w[20]=F(v[25]),w[21]=F(v[30]),w[22]=F(v[41]),w[23]=F(v[43]),w[24]=F(v[9]),w[25]=F(v[11]),w[26]=F(v[18]),w[27]=F(v[24]),w[28]=F(v[31]),w[29]=F(v[40]),w[30]=F(v[44]),w[31]=F(v[53]),w[32]=F(v[10]),w[33]=F(v[19]),w[34]=F(v[23]),w[35]=F(v[32]),w[36]=F(v[39]),w[37]=F(v[45]),w[38]=F(v[52]),w[39]=F(v[54]),w[40]=F(v[20]),w[41]=F(v[22]),w[42]=F(v[33]),w[43]=F(v[38]),w[44]=F(v[46]),w[45]=F(v[51]),w[46]=F(v[55]),w[47]=F(v[60]),w[48]=F(v[21]),w[49]=F(v[34]),w[50]=F(v[37]),w[51]=F(v[47]),w[52]=F(v[50]),w[53]=F(v[56]),w[54]=F(v[59]),w[55]=F(v[61]),w[56]=F(v[35]),w[57]=F(v[36]),w[58]=F(v[48]),w[59]=F(v[49]),w[60]=F(v[57]),w[61]=F(v[58]),w[62]=F(v[62]),w[63]=F(v[63]),function(a){let b=.5*Math.cos(3.14159/16),c=.5*Math.cos(3.14159/8),d=.5*Math.cos(3*3.14159/16),e=.5*Math.cos(3*3.14159/8);for(var f=[,,,,],g=[,,,,],h=[,,,,],i=[,,,,],j=0;j<8;++j){var k=8*j;f[0]=c*a[k+2],f[1]=e*a[k+2],f[2]=c*a[k+6],f[3]=e*a[k+6],g[0]=b*a[k+1]+d*a[k+3]+.2777854612564676*a[k+5]+.09754573032714427*a[k+7],g[1]=d*a[k+1]-.09754573032714427*a[k+3]-b*a[k+5]-.2777854612564676*a[k+7],g[2]=.2777854612564676*a[k+1]-b*a[k+3]+.09754573032714427*a[k+5]+d*a[k+7],g[3]=.09754573032714427*a[k+1]-.2777854612564676*a[k+3]+d*a[k+5]-b*a[k+7],h[0]=.35355362513961314*(a[k+0]+a[k+4]),h[3]=.35355362513961314*(a[k+0]-a[k+4]),h[1]=f[0]+f[3],h[2]=f[1]-f[2],i[0]=h[0]+h[1],i[1]=h[3]+h[2],i[2]=h[3]-h[2],i[3]=h[0]-h[1],a[k+0]=i[0]+g[0],a[k+1]=i[1]+g[1],a[k+2]=i[2]+g[2],a[k+3]=i[3]+g[3],a[k+4]=i[3]-g[3],a[k+5]=i[2]-g[2],a[k+6]=i[1]-g[1],a[k+7]=i[0]-g[0]}for(var l=0;l<8;++l)f[0]=c*a[16+l],f[1]=e*a[16+l],f[2]=c*a[48+l],f[3]=e*a[48+l],g[0]=b*a[8+l]+d*a[24+l]+.2777854612564676*a[40+l]+.09754573032714427*a[56+l],g[1]=d*a[8+l]-.09754573032714427*a[24+l]-b*a[40+l]-.2777854612564676*a[56+l],g[2]=.2777854612564676*a[8+l]-b*a[24+l]+.09754573032714427*a[40+l]+d*a[56+l],g[3]=.09754573032714427*a[8+l]-.2777854612564676*a[24+l]+d*a[40+l]-b*a[56+l],h[0]=.35355362513961314*(a[l]+a[32+l]),h[3]=.35355362513961314*(a[l]-a[32+l]),h[1]=f[0]+f[3],h[2]=f[1]-f[2],i[0]=h[0]+h[1],i[1]=h[3]+h[2],i[2]=h[3]-h[2],i[3]=h[0]-h[1],a[0+l]=i[0]+g[0],a[8+l]=i[1]+g[1],a[16+l]=i[2]+g[2],a[24+l]=i[3]+g[3],a[32+l]=i[3]-g[3],a[40+l]=i[2]-g[2],a[48+l]=i[1]-g[1],a[56+l]=i[0]-g[0]}(q[a])}for(var z=q,A=0;A<64;++A){var B=z[0][A],C=z[1][A],D=z[2][A];z[0][A]=B+1.5747*D,z[1][A]=B-.1873*C-.4682*D,z[2][A]=B+1.8556*C}for(let b=0;b<3;++b)!function(a,b,c){for(var d,e=0;e<64;++e){b[c+e]=s.DataUtils.toHalfFloat((d=a[e])<=1?Math.sign(d)*Math.pow(Math.abs(d),2.2):Math.sign(d)*Math.pow(9.025013291561939,Math.abs(d)-1))}}(q[b],t[b],64*a)}let f=0;for(let d=0;d<3;++d){let e=c[a.idx[d]].type;for(let a=8*b;a<8*b+x;++a){f=u[d][a];for(let b=0;b<j;++b){let c=64*b+(7&a)*8;g.setUint16(f+0*e,t[d][c+0],!0),g.setUint16(f+2*e,t[d][c+1],!0),g.setUint16(f+4*e,t[d][c+2],!0),g.setUint16(f+6*e,t[d][c+3],!0),g.setUint16(f+8*e,t[d][c+4],!0),g.setUint16(f+10*e,t[d][c+5],!0),g.setUint16(f+12*e,t[d][c+6],!0),g.setUint16(f+14*e,t[d][c+7],!0),f+=16*e}}if(j!=k)for(let a=8*b;a<8*b+x;++a){let b=u[d][a]+8*j*2*e,c=64*j+(7&a)*8;for(let a=0;a<y;++a)g.setUint16(b+2*a*e,t[d][c+a],!0)}}}for(var E=new Uint16Array(h),g=new DataView(f.buffer),G=0;G<3;++G){c[a.idx[G]].decoded=!0;var H=c[a.idx[G]].type;if(2==c[G].type)for(var I=0;I<i;++I){let a=u[G][I];for(var J=0;J<h;++J)E[J]=g.getUint16(a+2*J*H,!0);for(var J=0;J<h;++J)g.setFloat32(a+2*J*H,F(E[J]),!0)}}}(v,J,o,z,E,d);for(var q=0;q<o.length;++q){var r=o[q];if(!r.decoded)if(2===r.compression)for(var N=0,O=0,K=0;K<a.lines;++K){for(var P=J[q][N],Q=0;Q<r.width;++Q){for(var R=0;R<2*r.type;++R)d[P++]=H[O+R*r.width*r.height];O++}N++}else throw"EXRLoader.parse: unsupported channel compression"}return new DataView(d.buffer)}function x(a,b){for(var c=new Uint8Array(a),d=0;0!=c[b.value+d];)d+=1;var e=new TextDecoder().decode(c.slice(b.value,b.value+d));return b.value=b.value+d+1,e}function y(a,b){var c=a.getInt32(b.value,!0);return b.value=b.value+4,c}function z(a,b){var c=a.getUint32(b.value,!0);return b.value=b.value+4,c}function A(a,b){var c=a[b.value];return b.value=b.value+1,c}function B(a,b){var c=a.getUint8(b.value);return b.value=b.value+1,c}let C=function(a,b){let c;return c="getBigInt64"in DataView.prototype?Number(a.getBigInt64(b.value,!0)):a.getUint32(b.value+4,!0)+Number(a.getUint32(b.value,!0)<<32),b.value+=8,c};function D(a,b){var c=a.getFloat32(b.value,!0);return b.value+=4,c}function E(a,b){return s.DataUtils.toHalfFloat(D(a,b))}function F(a){var b=(31744&a)>>10,c=1023&a;return(a>>15?-1:1)*(b?31===b?c?NaN:1/0:Math.pow(2,b-15)*(1+c/1024):c/1024*6103515625e-14)}function G(a,b){var c=a.getUint16(b.value,!0);return b.value+=2,c}function H(a,b){return F(G(a,b))}let I=new DataView(a),J=new Uint8Array(a),K={value:0},L=function(a,b,c){let d={};if(0x1312f76!=a.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";d.version=a.getUint8(4);let e=a.getUint8(5);d.spec={singleTile:!!(2&e),longName:!!(4&e),deepFormat:!!(8&e),multiPart:!!(16&e)},c.value=8;for(var f=!0;f;){var g=x(b,c);if(0==g)f=!1;else{var h=x(b,c),i=z(a,c),j=function(a,b,c,d,e){var f,g,h,i,j,k,l;if("string"===d||"stringvector"===d||"iccProfile"===d)return f=new TextDecoder().decode(new Uint8Array(b).slice(c.value,c.value+e)),c.value=c.value+e,f;if("chlist"===d)return function(a,b,c,d){for(var e=c.value,f=[];c.value<e+d-1;){var g=x(b,c),h=y(a,c),i=B(a,c);c.value+=3;var j=y(a,c),k=y(a,c);f.push({name:g,pixelType:h,pLinear:i,xSampling:j,ySampling:k})}return c.value+=1,f}(a,b,c,e);if("chromaticities"===d)return g=D(a,c),h=D(a,c),i=D(a,c),j=D(a,c),k=D(a,c),{redX:g,redY:h,greenX:i,greenY:j,blueX:k,blueY:D(a,c),whiteX:D(a,c),whiteY:D(a,c)};if("compression"===d)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][B(a,c)];if("box2i"===d)return l=z(a,c),{xMin:l,yMin:z(a,c),xMax:z(a,c),yMax:z(a,c)};else if("lineOrder"===d)return["INCREASING_Y"][B(a,c)];else if("float"===d)return D(a,c);else if("v2f"===d)return[D(a,c),D(a,c)];else if("v3f"===d)return[D(a,c),D(a,c),D(a,c)];else if("int"===d)return y(a,c);else if("rational"===d)return[y(a,c),z(a,c)];else if("timecode"===d)return[z(a,c),z(a,c)];else return"preview"===d?(c.value+=e,"skipped"):(c.value+=e,void 0)}(a,b,c,h,i);void 0===j?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${h}'.`):d[g]=j}}if((-5&e)!=0)throw console.error("EXRHeader:",d),"THREE.EXRLoader: provided file is currently unsupported.";return d}(I,a,K),M=function(a,b,c,d,e){let f={size:0,viewer:b,array:c,offset:d,width:a.dataWindow.xMax-a.dataWindow.xMin+1,height:a.dataWindow.yMax-a.dataWindow.yMin+1,channels:a.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:a.channels[0].pixelType,uncompress:null,getter:null,format:null,[bb?"colorSpace":"encoding"]:null};switch(a.compression){case"NO_COMPRESSION":f.lines=1,f.uncompress=q;break;case"RLE_COMPRESSION":f.lines=1,f.uncompress=r;break;case"ZIPS_COMPRESSION":f.lines=1,f.uncompress=t;break;case"ZIP_COMPRESSION":f.lines=16,f.uncompress=t;break;case"PIZ_COMPRESSION":f.lines=32,f.uncompress=u;break;case"PXR24_COMPRESSION":f.lines=16,f.uncompress=v;break;case"DWAA_COMPRESSION":f.lines=32,f.uncompress=w;break;case"DWAB_COMPRESSION":f.lines=256,f.uncompress=w;break;default:throw"EXRLoader.parse: "+a.compression+" is unsupported"}if(f.scanlineBlockSize=f.lines,1==f.type)switch(e){case s.FloatType:f.getter=H,f.inputSize=2;break;case s.HalfFloatType:f.getter=G,f.inputSize=2}else if(2==f.type)switch(e){case s.FloatType:f.getter=D,f.inputSize=4;break;case s.HalfFloatType:f.getter=E,f.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+f.type+" for "+a.compression+".";f.blockCount=(a.dataWindow.yMax+1)/f.scanlineBlockSize;for(var g=0;g<f.blockCount;g++)C(b,d);f.outputChannels=3==f.channels?4:f.channels;let h=f.width*f.height*f.outputChannels;switch(e){case s.FloatType:f.byteArray=new Float32Array(h),f.channels<f.outputChannels&&f.byteArray.fill(1,0,h);break;case s.HalfFloatType:f.byteArray=new Uint16Array(h),f.channels<f.outputChannels&&f.byteArray.fill(15360,0,h);break;default:console.error("THREE.EXRLoader: unsupported type: ",e)}return f.bytesPerLine=f.width*f.inputSize*f.channels,4==f.outputChannels?f.format=s.RGBAFormat:f.format=s.RedFormat,bb?f.colorSpace="srgb-linear":f.encoding=3e3,f}(L,I,J,K,this.type),N={value:0},O={R:0,G:1,B:2,A:3,Y:0};for(let a=0;a<M.height/M.scanlineBlockSize;a++){let b=z(I,K);M.size=z(I,K),M.lines=b+M.scanlineBlockSize>M.height?M.height-b:M.scanlineBlockSize;let c=M.size<M.lines*M.bytesPerLine?M.uncompress(M):q(M);K.value+=M.size;for(let b=0;b<M.scanlineBlockSize;b++){let d=b+a*M.scanlineBlockSize;if(d>=M.height)break;for(let a=0;a<M.channels;a++){let e=O[L.channels[a].name];for(let f=0;f<M.width;f++){N.value=(b*(M.channels*M.width)+a*M.width+f)*M.inputSize;let g=(M.height-1-d)*(M.width*M.outputChannels)+f*M.outputChannels+e;M.byteArray[g]=M.getter(c,N)}}}}return{header:L,width:M.width,height:M.height,data:M.byteArray,format:M.format,[bb?"colorSpace":"encoding"]:M[bb?"colorSpace":"encoding"],type:this.type}}setDataType(a){return this.type=a,this}load(a,b,c,d){return super.load(a,function(a,c){bb?a.colorSpace=c.colorSpace:a.encoding=c.encoding,a.minFilter=s.LinearFilter,a.magFilter=s.LinearFilter,a.generateMipmaps=!1,a.flipY=!1,b&&b(a,c)},c,d)}}var bd=a.i(66110);let be=(a,b,c)=>{let d;switch(a){case l.UnsignedByteType:d=new Uint8ClampedArray(b*c*4);break;case l.HalfFloatType:d=new Uint16Array(b*c*4);break;case l.UnsignedIntType:d=new Uint32Array(b*c*4);break;case l.ByteType:d=new Int8Array(b*c*4);break;case l.ShortType:d=new Int16Array(b*c*4);break;case l.IntType:d=new Int32Array(b*c*4);break;case l.FloatType:d=new Float32Array(b*c*4);break;default:throw Error("Unsupported data type")}return d};class bf{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(a){this._width=a.width,this._height=a.height,this._type=a.type,this._colorSpace=a.colorSpace;const c={format:l.RGBAFormat,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:a.renderTargetOptions?.anisotropy!==void 0?a.renderTargetOptions?.anisotropy:1,generateMipmaps:a.renderTargetOptions?.generateMipmaps!==void 0&&a.renderTargetOptions?.generateMipmaps,magFilter:a.renderTargetOptions?.magFilter!==void 0?a.renderTargetOptions?.magFilter:l.LinearFilter,minFilter:a.renderTargetOptions?.minFilter!==void 0?a.renderTargetOptions?.minFilter:l.LinearFilter,samples:a.renderTargetOptions?.samples!==void 0?a.renderTargetOptions?.samples:void 0,wrapS:a.renderTargetOptions?.wrapS!==void 0?a.renderTargetOptions?.wrapS:l.ClampToEdgeWrapping,wrapT:a.renderTargetOptions?.wrapT!==void 0?a.renderTargetOptions?.wrapT:l.ClampToEdgeWrapping};if(this._material=a.material,a.renderer?this._renderer=a.renderer:(this._renderer=bf.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new l.Scene,this._camera=new l.OrthographicCamera,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((a,c,d,e)=>{if(void 0!==b)return b;let f=new l.WebGLRenderTarget(1,1,e);c.setRenderTarget(f);let g=new l.Mesh(new l.PlaneGeometry,new l.MeshBasicMaterial({color:0xffffff}));c.render(g,d),c.setRenderTarget(null);let h=be(a,f.width,f.height);return c.readRenderTargetPixels(f,0,0,f.width,f.height,h),f.dispose(),g.geometry.dispose(),g.material.dispose(),b=0!==h[0]})(this._type,this._renderer,this._camera,c)){let a;this._type===l.HalfFloatType&&(a=this._renderer.extensions.has("EXT_color_buffer_float")?l.FloatType:void 0),void 0!==a?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${l.FloatType}`),this._type=a):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new l.Mesh(new l.PlaneGeometry,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new l.WebGLRenderTarget(this.width,this.height,c),this._renderTarget.texture.mapping=a.renderTargetOptions?.mapping!==void 0?a.renderTargetOptions?.mapping:l.UVMapping}static instantiateRenderer(){let a=new bd.WebGLRenderer;return a.setSize(128,128),a}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(a){throw this._renderer.setRenderTarget(null),a}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw Error("Can't read pixels in this browser");let a=be(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,a),a}toDataTexture(a){let b=new l.DataTexture(this.toArray(),this.width,this.height,l.RGBAFormat,this._type,a?.mapping||l.UVMapping,a?.wrapS||l.ClampToEdgeWrapping,a?.wrapT||l.ClampToEdgeWrapping,a?.magFilter||l.LinearFilter,a?.minFilter||l.LinearFilter,a?.anisotropy||1,l.LinearSRGBColorSpace);return b.generateMipmaps=a?.generateMipmaps!==void 0&&a?.generateMipmaps,b}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(a){this.disposeOnDemandRenderer(),a&&this.renderTarget.dispose(),this.material instanceof l.ShaderMaterial&&Object.values(this.material.uniforms).forEach(a=>{a.value instanceof l.Texture&&a.value.dispose()}),Object.values(this.material).forEach(a=>{a instanceof l.Texture&&a.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(a){this._width=a,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(a){this._height=a,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(a){this._renderTarget=a,this._width=a.width,this._height=a.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}var bg=l;class bh extends Error{}class bi extends Error{}let bj=(a,b,c)=>{let d=RegExp(`${b}="([^"]*)"`,"i").exec(a);if(d)return d[1];let e=RegExp(`<${b}[^>]*>([\\s\\S]*?)</${b}>`,"i").exec(a);if(e){let a=e[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return a&&3===a.length?a.map(a=>a.replace(/<\/?rdf:li>/g,"")):e[1].trim()}if(void 0!==c)return c;throw Error(`Can't find ${b} in gainmap metadata`)};class bk{options;constructor(a){this.options={debug:!!a&&void 0!==a.debug&&a.debug,extractFII:!a||void 0===a.extractFII||a.extractFII,extractNonFII:!a||void 0===a.extractNonFII||a.extractNonFII}}extract(a){return new Promise((b,c)=>{let d,e=this.options.debug,f=new DataView(a.buffer);if(65496!==f.getUint16(0))return void c(Error("Not a valid jpeg"));let g=f.byteLength,h=2,i=0;for(;h<g;){if(++i>250)return void c(Error(`Found no marker after ${i} loops `));if(255!==f.getUint8(h))return void c(Error(`Not a valid marker at offset 0x${h.toString(16)}, found: 0x${f.getUint8(h).toString(16)}`));if(d=f.getUint8(h+1),e&&console.log(`Marker: ${d.toString(16)}`),226===d){e&&console.log("Found APP2 marker (0xffe2)");let a=h+4;if(0x4d504600===f.getUint32(a)){let d,e=a+4;if(18761===f.getUint16(e))d=!1;else{if(19789!==f.getUint16(e))return void c(Error("No valid endianness marker found in TIFF header"));d=!0}if(42!==f.getUint16(e+2,!d))return void c(Error("Not valid TIFF data! (no 0x002A marker)"));let g=f.getUint32(e+4,!d);if(g<8)return void c(Error("Not valid TIFF data! (First offset less than 8)"));let h=e+g,i=f.getUint16(h,!d),j=h+2,k=0;for(let a=j;a<j+12*i;a+=12)45057===f.getUint16(a,!d)&&(k=f.getUint32(a+8,!d));let l=h+2+12*i+4,m=[];for(let a=l;a<l+16*k;a+=16){let b={MPType:f.getUint32(a,!d),size:f.getUint32(a+4,!d),dataOffset:f.getUint32(a+8,!d),dependantImages:f.getUint32(a+12,!d),start:-1,end:-1,isFII:!1};b.dataOffset?(b.start=e+b.dataOffset,b.isFII=!1):(b.start=0,b.isFII=!0),b.end=b.start+b.size,m.push(b)}if(this.options.extractNonFII&&m.length){let a=new Blob([f]),c=[];for(let b of m){if(b.isFII&&!this.options.extractFII)continue;let d=a.slice(b.start,b.end+1,"image/jpeg");c.push(d)}b(c)}}}h+=2+f.getUint16(h+2)}})}}let bl=async a=>{let b=(a=>{let b,c=(b="undefined"!=typeof TextDecoder?new TextDecoder().decode(a):a.toString()).indexOf("<x:xmpmeta");for(;-1!==c;){let a=b.indexOf("x:xmpmeta>",c),d=b.slice(c,a+10);try{let a=bj(d,"hdrgm:GainMapMin","0"),b=bj(d,"hdrgm:GainMapMax"),c=bj(d,"hdrgm:Gamma","1"),e=bj(d,"hdrgm:OffsetSDR","0.015625"),f=bj(d,"hdrgm:OffsetHDR","0.015625"),g=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(d),h=g?g[1]:"0",i=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(d);if(!i)throw Error("Incomplete gainmap metadata");let j=i[1];return{gainMapMin:Array.isArray(a)?a.map(a=>parseFloat(a)):[parseFloat(a),parseFloat(a),parseFloat(a)],gainMapMax:Array.isArray(b)?b.map(a=>parseFloat(a)):[parseFloat(b),parseFloat(b),parseFloat(b)],gamma:Array.isArray(c)?c.map(a=>parseFloat(a)):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetSdr:Array.isArray(e)?e.map(a=>parseFloat(a)):[parseFloat(e),parseFloat(e),parseFloat(e)],offsetHdr:Array.isArray(f)?f.map(a=>parseFloat(a)):[parseFloat(f),parseFloat(f),parseFloat(f)],hdrCapacityMin:parseFloat(h),hdrCapacityMax:parseFloat(j)}}catch(a){}c=b.indexOf("<x:xmpmeta",a)}})(a);if(!b)throw new bi("Gain map XMP metadata not found");let c=new bk({extractFII:!0,extractNonFII:!0}),d=await c.extract(a);if(2!==d.length)throw new bh("Gain map recovery image not found");return{sdr:new Uint8Array(await d[0].arrayBuffer()),gainMap:new Uint8Array(await d[1].arrayBuffer()),metadata:b}},bm=a=>new Promise((b,c)=>{let d=document.createElement("img");d.onload=()=>{b(d)},d.onerror=a=>{c(a)},d.src=URL.createObjectURL(a)});class bn extends bg.Loader{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(a,b){super(b),this._config=a,a.renderer&&(this._renderer=a.renderer),this._internalLoadingManager=new bg.LoadingManager}setRenderer(a){return this._renderer=a,this}setRenderTargetOptions(a){return this._renderTargetOptions=a,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");let a=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new bg.Texture,sdr:new bg.Texture});return this._config.createQuadRenderer({width:16,height:16,type:bg.HalfFloatType,colorSpace:bg.LinearSRGBColorSpace,material:a,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(a,b,c){let d,e,f=b?new Blob([b],{type:"image/jpeg"}):void 0,g=new Blob([a],{type:"image/jpeg"}),h=!1;if("undefined"==typeof createImageBitmap){let a=await Promise.all([f?bm(f):Promise.resolve(void 0),bm(g)]);e=a[0],d=a[1],h="flipY"===c}else{let a=await Promise.all([f?createImageBitmap(f,{imageOrientation:c||"flipY"}):Promise.resolve(void 0),createImageBitmap(g,{imageOrientation:c||"flipY"})]);e=a[0],d=a[1]}return{sdrImage:d,gainMapImage:e,needsFlip:h}}createTextures(a,b,c){let d=new bg.Texture(b||new ImageData(2,2),bg.UVMapping,bg.ClampToEdgeWrapping,bg.ClampToEdgeWrapping,bg.LinearFilter,bg.LinearMipMapLinearFilter,bg.RGBAFormat,bg.UnsignedByteType,1,bg.LinearSRGBColorSpace);d.flipY=c,d.needsUpdate=!0;let e=new bg.Texture(a,bg.UVMapping,bg.ClampToEdgeWrapping,bg.ClampToEdgeWrapping,bg.LinearFilter,bg.LinearMipMapLinearFilter,bg.RGBAFormat,bg.UnsignedByteType,1,bg.SRGBColorSpace);return e.flipY=c,e.needsUpdate=!0,{gainMap:d,sdr:e}}updateQuadRenderer(a,b,c,d,e){a.width=b.width,a.height=b.height,a.material.gainMap=c,a.material.sdr=d,a.material.gainMapMin=e.gainMapMin,a.material.gainMapMax=e.gainMapMax,a.material.offsetHdr=e.offsetHdr,a.material.offsetSdr=e.offsetSdr,a.material.gamma=e.gamma,a.material.hdrCapacityMin=e.hdrCapacityMin,a.material.hdrCapacityMax=e.hdrCapacityMax,a.material.maxDisplayBoost=Math.pow(2,e.hdrCapacityMax),a.material.needsUpdate=!0}}var bo=l;let bp=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,bq=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class br extends bo.ShaderMaterial{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:a,offsetHdr:b,offsetSdr:c,gainMapMin:d,gainMapMax:e,maxDisplayBoost:f,hdrCapacityMin:g,hdrCapacityMax:h,sdr:i,gainMap:j}){super({name:"GainMapDecoderMaterial",vertexShader:bp,fragmentShader:bq,uniforms:{sdr:{value:i},gainMap:{value:j},gamma:{value:new bo.Vector3(1/a[0],1/a[1],1/a[2])},offsetHdr:{value:new bo.Vector3().fromArray(b)},offsetSdr:{value:new bo.Vector3().fromArray(c)},gainMapMin:{value:new bo.Vector3().fromArray(d)},gainMapMax:{value:new bo.Vector3().fromArray(e)},weightFactor:{value:(Math.log2(f)-g)/(h-g)}},blending:bo.NoBlending,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=f,this._hdrCapacityMin=g,this._hdrCapacityMax=h,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(a){this.uniforms.sdr.value=a}get gainMap(){return this.uniforms.gainMap.value}set gainMap(a){this.uniforms.gainMap.value=a}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(a){this.uniforms.offsetHdr.value.fromArray(a)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(a){this.uniforms.offsetSdr.value.fromArray(a)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(a){this.uniforms.gainMapMin.value.fromArray(a)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(a){this.uniforms.gainMapMax.value.fromArray(a)}get gamma(){let a=this.uniforms.gamma.value;return[1/a.x,1/a.y,1/a.z]}set gamma(a){let b=this.uniforms.gamma.value;b.x=1/a[0],b.y=1/a[1],b.z=1/a[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(a){this._hdrCapacityMin=a,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(a){this._hdrCapacityMax=a,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(a){this._maxDisplayBoost=Math.max(1,Math.min(65504,a)),this.calculateWeight()}calculateWeight(){let a=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,a))}}c={renderer:bd.WebGLRenderer,createMaterial:a=>new br(a),createQuadRenderer:a=>new bf(a)},a=>{let{sdr:b,gainMap:d,renderer:e}=a;b.colorSpace!==bg.SRGBColorSpace&&(console.warn("SDR Colorspace needs to be *SRGBColorSpace*, setting it automatically"),b.colorSpace=bg.SRGBColorSpace),b.needsUpdate=!0,d.colorSpace!==bg.LinearSRGBColorSpace&&(console.warn("Gainmap Colorspace needs to be *LinearSRGBColorSpace*, setting it automatically"),d.colorSpace=bg.LinearSRGBColorSpace),d.needsUpdate=!0;let f=c.createMaterial({...a,sdr:b,gainMap:d});return c.createQuadRenderer({width:b.image.width,height:b.image.height,type:bg.HalfFloatType,colorSpace:bg.LinearSRGBColorSpace,material:f,renderer:e,renderTargetOptions:a.renderTargetOptions})};class bs extends bn{constructor(a,b){super({renderer:a,createMaterial:a=>new br(a),createQuadRenderer:a=>new bf(a)},b)}async render(a,b,c,d){let{sdrImage:e,gainMapImage:f,needsFlip:g}=await this.processImages(c,d,"flipY"),{gainMap:h,sdr:i}=this.createTextures(e,f,g);this.updateQuadRenderer(a,e,h,i,b),a.render()}}class bt extends bs{load([a,b,c],d,e,f){let g,h,i,j=this.prepareQuadRenderer(),k=async()=>{if(g&&h&&i){try{await this.render(j,i,g,h)}catch(d){this.manager.itemError(a),this.manager.itemError(b),this.manager.itemError(c),"function"==typeof f&&f(d),j.disposeOnDemandRenderer();return}"function"==typeof d&&d(j),this.manager.itemEnd(a),this.manager.itemEnd(b),this.manager.itemEnd(c),j.disposeOnDemandRenderer()}},l=!0,m=0,n=0,o=!0,p=0,q=0,r=!0,s=0,t=0,u=()=>{"function"==typeof e&&e(new ProgressEvent("progress",{lengthComputable:l&&o&&r,loaded:n+q+t,total:m+p+s}))};this.manager.itemStart(a),this.manager.itemStart(b),this.manager.itemStart(c);let v=new bo.FileLoader(this._internalLoadingManager);v.setResponseType("arraybuffer"),v.setRequestHeader(this.requestHeader),v.setPath(this.path),v.setWithCredentials(this.withCredentials),v.load(a,async a=>{if("string"==typeof a)throw Error("Invalid sdr buffer");g=a,await k()},a=>{l=a.lengthComputable,n=a.loaded,m=a.total,u()},b=>{this.manager.itemError(a),"function"==typeof f&&f(b)});let w=new bo.FileLoader(this._internalLoadingManager);w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(b,async a=>{if("string"==typeof a)throw Error("Invalid gainmap buffer");h=a,await k()},a=>{o=a.lengthComputable,q=a.loaded,p=a.total,u()},a=>{this.manager.itemError(b),"function"==typeof f&&f(a)});let x=new bo.FileLoader(this._internalLoadingManager);return x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(this.withCredentials),x.load(c,async a=>{if("string"!=typeof a)throw Error("Invalid metadata string");i=JSON.parse(a),await k()},a=>{r=a.lengthComputable,t=a.loaded,s=a.total,u()},a=>{this.manager.itemError(c),"function"==typeof f&&f(a)}),j}}class bu extends bs{load(a,b,c,d){let e=this.prepareQuadRenderer(),f=new bo.FileLoader(this._internalLoadingManager);return f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setPath(this.path),f.setWithCredentials(this.withCredentials),this.manager.itemStart(a),f.load(a,async c=>{let f,g,h;if("string"==typeof c)throw Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");let i=new Uint8Array(c);try{let a=await bl(i);f=a.sdr,g=a.gainMap,h=a.metadata}catch(b){if(b instanceof bi||b instanceof bh)console.warn(`Failure to reconstruct an HDR image from ${a}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),h={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},f=i;else throw b}try{await this.render(e,h,f.buffer,g?.buffer)}catch(b){this.manager.itemError(a),"function"==typeof d&&d(b),e.disposeOnDemandRenderer();return}"function"==typeof b&&b(e),this.manager.itemEnd(a),e.disposeOnDemandRenderer()},c,b=>{this.manager.itemError(a),"function"==typeof d&&d(b)}),e}}let bv={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},bw="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",bx=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function by({files:a=bx,path:b="",preset:c,encoding:d,extensions:e}={}){let h=null,i=!1;c&&(bB(c),a=bv[c],b=bw),i=Array.isArray(a);let{extension:j,isCubemap:k}=bC(a);if(!(h=bD(j)))throw Error("useEnvironment: Unrecognized file extension: "+a);let m=(0,g.useThree)(a=>a.gl);(0,f.useLayoutEffect)(()=>{("webp"===j||"jpg"===j||"jpeg"===j)&&m.domElement.addEventListener("webglcontextlost",function(){p.G.clear(h,i?[a]:a)},{once:!0})},[a,m.domElement]);let n=(0,p.G)(h,i?[a]:a,a=>{("webp"===j||"jpg"===j||"jpeg"===j)&&a.setRenderer(m),null==a.setPath||a.setPath(b),e&&e(a)}),o=i?n[0]:n;if("jpg"===j||"jpeg"===j||"webp"===j){var q;o=null==(q=o.renderTarget)?void 0:q.texture}return o.mapping=k?l.CubeReflectionMapping:l.EquirectangularReflectionMapping,"colorSpace"in o?o.colorSpace=(null!=d?d:k)?"srgb":"srgb-linear":o.encoding=(null!=d?d:k)?3001:3e3,o}let bz={files:bx,path:"",preset:void 0,extensions:void 0};by.preload=a=>{let b={...bz,...a},{files:c,path:d=""}=b,{preset:e,extensions:f}=b;e&&(bB(e),c=bv[e],d=bw);let{extension:g}=bC(c);if("webp"===g||"jpg"===g||"jpeg"===g)throw Error("useEnvironment: Preloading gainmaps is not supported");let h=bD(g);if(!h)throw Error("useEnvironment: Unrecognized file extension: "+c);p.G.preload(h,Array.isArray(c)?[c]:c,a=>{null==a.setPath||a.setPath(d),f&&f(a)})};let bA={files:bx,preset:void 0};function bB(a){if(!(a in bv))throw Error("Preset must be one of: "+Object.keys(bv).join(", "))}function bC(a){var b;let c=Array.isArray(a)&&6===a.length,d=Array.isArray(a)&&3===a.length&&a.some(a=>a.endsWith("json")),e=Array.isArray(a)?a[0]:a;return{extension:c?"cube":d?"webp":e.startsWith("data:application/exr")?"exr":e.startsWith("data:application/hdr")?"hdr":e.startsWith("data:image/jpeg")?"jpg":null==(b=e.split(".").pop())||null==(b=b.split("?"))||null==(b=b.shift())?void 0:b.toLowerCase(),isCubemap:c,isGainmap:d}}function bD(a){return"cube"===a?l.CubeTextureLoader:"hdr"===a?r:"exr"===a?bc:"jpg"===a||"jpeg"===a?bu:"webp"===a?bt:null}function bE(a,b,c,d,e={}){var f,g,h,i,k;let l;e={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...e};let m=(l=k=b||c).current&&l.current.isScene?k.current:k,n=m.background,o=m.environment,p={backgroundBlurriness:m.backgroundBlurriness,backgroundIntensity:m.backgroundIntensity,backgroundRotation:null!=(f=null==(g=m.backgroundRotation)||null==g.clone?void 0:g.clone())?f:[0,0,0],environmentIntensity:m.environmentIntensity,environmentRotation:null!=(h=null==(i=m.environmentRotation)||null==i.clone?void 0:i.clone())?h:[0,0,0]};return"only"!==a&&(m.environment=d),a&&(m.background=d),(0,j.s)(m,e),()=>{"only"!==a&&(m.environment=o),a&&(m.background=n),(0,j.s)(m,p)}}function bF({scene:a,background:b=!1,map:c,...d}){let e=(0,g.useThree)(a=>a.scene);return f.useLayoutEffect(()=>{if(c)return bE(b,a,e,c,d)}),null}function bG({background:a=!1,scene:b,blur:c,backgroundBlurriness:d,backgroundIntensity:e,backgroundRotation:h,environmentIntensity:i,environmentRotation:j,...k}){let l=by(k),m=(0,g.useThree)(a=>a.scene);return f.useLayoutEffect(()=>bE(a,b,m,l,{backgroundBlurriness:null!=c?c:d,backgroundIntensity:e,backgroundRotation:h,environmentIntensity:i,environmentRotation:j})),f.useEffect(()=>()=>{l.dispose()},[l]),null}function bH({children:a,near:b=.1,far:c=1e3,resolution:d=256,frames:e=1,map:j,background:k=!1,blur:m,backgroundBlurriness:n,backgroundIntensity:o,backgroundRotation:p,environmentIntensity:q,environmentRotation:r,scene:s,files:t,path:u,preset:v,extensions:w}){let x=(0,g.useThree)(a=>a.gl),y=(0,g.useThree)(a=>a.scene),z=f.useRef(null),[A]=f.useState(()=>new l.Scene),B=f.useMemo(()=>{let a=new l.WebGLCubeRenderTarget(d);return a.texture.type=l.HalfFloatType,a},[d]);f.useEffect(()=>()=>{B.dispose()},[B]),f.useLayoutEffect(()=>{if(1===e){let a=x.autoClear;x.autoClear=!0,z.current.update(x,A),x.autoClear=a}return bE(k,s,y,B.texture,{backgroundBlurriness:null!=m?m:n,backgroundIntensity:o,backgroundRotation:p,environmentIntensity:q,environmentRotation:r})},[a,A,B.texture,s,y,k,e,x]);let C=1;return(0,h.useFrame)(()=>{if(e===1/0||C<e){let a=x.autoClear;x.autoClear=!0,z.current.update(x,A),x.autoClear=a,C++}}),f.createElement(f.Fragment,null,(0,i.o)(f.createElement(f.Fragment,null,a,f.createElement("cubeCamera",{ref:z,args:[b,c,B]}),t||v?f.createElement(bG,{background:!0,files:t,preset:v,path:u,extensions:w}):j?f.createElement(bF,{background:!0,map:j,extensions:w}):null),A))}function bI(a){var b,c,d,g;let h=by(a),i=a.map||h;f.useMemo(()=>(0,k.e)({GroundProjectedEnvImpl:o}),[]),f.useEffect(()=>()=>{h.dispose()},[h]);let j=f.useMemo(()=>[i],[i]),l=null==(b=a.ground)?void 0:b.height,m=null==(c=a.ground)?void 0:c.radius,n=null!=(d=null==(g=a.ground)?void 0:g.scale)?d:1e3;return f.createElement(f.Fragment,null,f.createElement(bF,(0,e.default)({},a,{map:i})),f.createElement("groundProjectedEnvImpl",{args:j,scale:n,height:l,radius:m}))}function bJ(a){return a.ground?f.createElement(bI,a):a.map?f.createElement(bF,a):a.children?f.createElement(bH,a):f.createElement(bG,a)}by.clear=a=>{let b={...bA,...a},{files:c}=b,{preset:d}=b;d&&(bB(d),c=bv[d]);let{extension:e}=bC(c),f=bD(e);if(!f)throw Error("useEnvironment: Unrecognized file extension: "+c);p.G.clear(f,Array.isArray(c)?[c]:c)},a.s(["Environment",()=>bJ],1236)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__8fc8d896._.js.map